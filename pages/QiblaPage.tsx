import React, { useEffect, useState, useMemo, useCallback, useRef } from 'react';
import { useAppStore } from '../context/Store';
import { getQiblaDirection } from '../services/api';

// SVG Icons
const KaabaIcon = ({ className = "", size = 24, isAligned = false }: { className?: string; size?: number; isAligned?: boolean }) => (
    <svg
        width={size}
        height={size}
        viewBox="0 0 512 512"
        fill="none"
        className={className}
    >
        {/* Kaaba base structure */}
<path d="M0 0 C1.01790619 0.00215515 2.03581238 0.0043103 3.08456421 0.00653076 C17.69363523 0.05620146 32.02575853 0.30709809 46.375 3.3125 C47.34985352 3.51117676 48.32470703 3.70985352 49.32910156 3.91455078 C97.7109774 14.03517194 141.69928269 35.9516877 177.375 70.3125 C178.3640332 71.26068604 178.3640332 71.26068604 179.37304688 72.22802734 C188.86130305 81.37247479 197.6012044 90.66984009 205.375 101.3125 C206.23306152 102.46355017 207.09113451 103.61459177 207.94921875 104.765625 C213.98736829 112.95680614 219.34595521 121.47054105 224.375 130.3125 C224.73948242 130.94430176 225.10396484 131.57610352 225.47949219 132.22705078 C247.08534998 169.97532572 256.85198095 212.74189997 256.6875 255.9375 C256.68534485 256.95540619 256.6831897 257.97331238 256.68096924 259.02206421 C256.63129854 273.63113523 256.38040191 287.96325853 253.375 302.3125 C253.07698486 303.77478027 253.07698486 303.77478027 252.77294922 305.26660156 C242.65232806 353.6484774 220.7358123 397.63678269 186.375 433.3125 C185.74287598 433.97185547 185.11075195 434.63121094 184.45947266 435.31054688 C175.31502521 444.79880305 166.01765991 453.5387044 155.375 461.3125 C154.22394983 462.17056152 153.07290823 463.02863451 151.921875 463.88671875 C143.73224019 469.92427396 135.22961724 475.30707302 126.375 480.3125 C125.66778809 480.7146875 124.96057617 481.116875 124.23193359 481.53125 C101.09654164 494.5566741 75.92537591 503.30551461 49.9375 508.625 C49.21860596 508.77235596 48.49971191 508.91971191 47.7590332 509.0715332 C33.08339502 511.86090125 18.55831162 512.66142619 3.64770508 512.62817383 C0.70811513 512.6250221 -2.2304558 512.64854926 -5.16992188 512.67382812 C-18.54306192 512.71848737 -31.43916711 511.51301542 -44.625 509.3125 C-46.33055054 509.03031616 -46.33055054 509.03031616 -48.07055664 508.74243164 C-91.33802759 500.97044532 -132.38793216 480.98345309 -165.625 452.3125 C-166.37007813 451.67828125 -167.11515625 451.0440625 -167.8828125 450.390625 C-181.38779833 438.57948485 -194.05918743 425.82889772 -204.625 411.3125 C-205.48149066 410.16255169 -206.33826433 409.01281411 -207.1953125 407.86328125 C-213.23534209 399.67315742 -218.61867614 391.16870382 -223.625 382.3125 C-224.0271875 381.60528809 -224.429375 380.89807617 -224.84375 380.16943359 C-237.8691741 357.03404164 -246.61801461 331.86287591 -251.9375 305.875 C-252.08485596 305.15610596 -252.23221191 304.43721191 -252.3840332 303.6965332 C-255.35789088 288.05024391 -255.99800362 272.57681954 -255.9375 256.6875 C-255.93534485 255.66959381 -255.9331897 254.65168762 -255.93096924 253.60293579 C-255.88129854 238.99386477 -255.63040191 224.66174147 -252.625 210.3125 C-252.42632324 209.33764648 -252.22764648 208.36279297 -252.02294922 207.35839844 C-241.90232806 158.9765226 -219.9858123 114.98821731 -185.625 79.3125 C-184.99287598 78.65314453 -184.36075195 77.99378906 -183.70947266 77.31445312 C-174.56502521 67.82619695 -165.26765991 59.0862956 -154.625 51.3125 C-153.47394983 50.45443848 -152.32290823 49.59636549 -151.171875 48.73828125 C-142.98224019 42.70072604 -134.47961724 37.31792698 -125.625 32.3125 C-124.91778809 31.9103125 -124.21057617 31.508125 -123.48193359 31.09375 C-100.34654164 18.0683259 -75.17537591 9.31948539 -49.1875 4 C-48.46860596 3.85264404 -47.74971191 3.70528809 -47.0090332 3.5534668 C-31.36274391 0.57960912 -15.88931954 -0.06050362 0 0 Z " fill="#414952" transform="translate(255.625,-0.3125)"/>
<path d="M0 0 C1.01790619 0.00215515 2.03581238 0.0043103 3.08456421 0.00653076 C17.69363523 0.05620146 32.02575853 0.30709809 46.375 3.3125 C47.34985352 3.51117676 48.32470703 3.70985352 49.32910156 3.91455078 C97.7109774 14.03517194 141.69928269 35.9516877 177.375 70.3125 C178.3640332 71.26068604 178.3640332 71.26068604 179.37304688 72.22802734 C188.86130305 81.37247479 197.6012044 90.66984009 205.375 101.3125 C206.23306152 102.46355017 207.09113451 103.61459177 207.94921875 104.765625 C213.98736829 112.95680614 219.34595521 121.47054105 224.375 130.3125 C224.73948242 130.94430176 225.10396484 131.57610352 225.47949219 132.22705078 C247.08534998 169.97532572 256.85198095 212.74189997 256.6875 255.9375 C256.68534485 256.95540619 256.6831897 257.97331238 256.68096924 259.02206421 C256.63129854 273.63113523 256.38040191 287.96325853 253.375 302.3125 C253.07698486 303.77478027 253.07698486 303.77478027 252.77294922 305.26660156 C242.65232806 353.6484774 220.7358123 397.63678269 186.375 433.3125 C185.74287598 433.97185547 185.11075195 434.63121094 184.45947266 435.31054688 C175.31502521 444.79880305 166.01765991 453.5387044 155.375 461.3125 C154.22394983 462.17056152 153.07290823 463.02863451 151.921875 463.88671875 C143.73224019 469.92427396 135.22961724 475.30707302 126.375 480.3125 C125.66778809 480.7146875 124.96057617 481.116875 124.23193359 481.53125 C101.09654164 494.5566741 75.92537591 503.30551461 49.9375 508.625 C49.21860596 508.77235596 48.49971191 508.91971191 47.7590332 509.0715332 C33.08339502 511.86090125 18.55831162 512.66142619 3.64770508 512.62817383 C0.70811513 512.6250221 -2.2304558 512.64854926 -5.16992188 512.67382812 C-18.54306192 512.71848737 -31.43916711 511.51301542 -44.625 509.3125 C-46.33055054 509.03031616 -46.33055054 509.03031616 -48.07055664 508.74243164 C-91.33802759 500.97044532 -132.38793216 480.98345309 -165.625 452.3125 C-166.37007813 451.67828125 -167.11515625 451.0440625 -167.8828125 450.390625 C-181.38779833 438.57948485 -194.05918743 425.82889772 -204.625 411.3125 C-205.48149066 410.16255169 -206.33826433 409.01281411 -207.1953125 407.86328125 C-213.23534209 399.67315742 -218.61867614 391.16870382 -223.625 382.3125 C-224.0271875 381.60528809 -224.429375 380.89807617 -224.84375 380.16943359 C-237.8691741 357.03404164 -246.61801461 331.86287591 -251.9375 305.875 C-252.08485596 305.15610596 -252.23221191 304.43721191 -252.3840332 303.6965332 C-255.35789088 288.05024391 -255.99800362 272.57681954 -255.9375 256.6875 C-255.93534485 255.66959381 -255.9331897 254.65168762 -255.93096924 253.60293579 C-255.88129854 238.99386477 -255.63040191 224.66174147 -252.625 210.3125 C-252.42632324 209.33764648 -252.22764648 208.36279297 -252.02294922 207.35839844 C-241.90232806 158.9765226 -219.9858123 114.98821731 -185.625 79.3125 C-184.99287598 78.65314453 -184.36075195 77.99378906 -183.70947266 77.31445312 C-174.56502521 67.82619695 -165.26765991 59.0862956 -154.625 51.3125 C-153.47394983 50.45443848 -152.32290823 49.59636549 -151.171875 48.73828125 C-142.98224019 42.70072604 -134.47961724 37.31792698 -125.625 32.3125 C-124.91778809 31.9103125 -124.21057617 31.508125 -123.48193359 31.09375 C-100.34654164 18.0683259 -75.17537591 9.31948539 -49.1875 4 C-48.46860596 3.85264404 -47.74971191 3.70528809 -47.0090332 3.5534668 C-31.36274391 0.57960912 -15.88931954 -0.06050362 0 0 Z M-7.43481445 81.95117188 C-8.62392426 82.31504501 -9.81303406 82.67891815 -11.03817749 83.05381775 C-12.35490064 83.46289137 -13.67160111 83.87203797 -14.98828125 84.28125 C-16.38099522 84.70950739 -17.77387278 85.13723311 -19.16690063 85.56446838 C-22.17570958 86.48833932 -25.18344473 87.41560052 -28.19039917 88.3454895 C-32.97553191 89.8251246 -37.76300658 91.29706861 -42.55102539 92.76733398 C-44.20189094 93.27433158 -45.85275457 93.78133543 -47.50361633 94.28834534 C-48.74736747 94.67030658 -48.74736747 94.67030658 -50.01624489 95.05998421 C-52.58226228 95.84831527 -55.14805345 96.63737881 -57.71379089 97.42662048 C-75.58737926 102.92349297 -93.47757228 108.36545165 -111.37069702 113.79833984 C-115.64749782 115.09693362 -119.9239073 116.39681037 -124.20018387 117.69712925 C-127.44156602 118.68260628 -130.68316048 119.66738342 -133.92481613 120.65196037 C-135.41301774 121.10406659 -136.90115272 121.5563922 -138.38920975 122.00897408 C-140.45448137 122.63700942 -142.52001447 123.26417475 -144.58569336 123.89086914 C-145.56379911 124.18795194 -145.56379911 124.18795194 -146.56166458 124.49103642 C-150.16433799 125.58138946 -153.77254637 126.64963907 -157.38796997 127.69699097 C-158.17309999 127.92501372 -158.95823 128.15303648 -159.76715183 128.38796902 C-161.28662561 128.82812454 -162.80692148 129.26545427 -164.32811642 129.69962406 C-167.75379414 130.47985844 -167.75379414 130.47985844 -170.625 132.3125 C-170.72103022 133.9320634 -170.74687855 135.55583083 -170.74525452 137.17823792 C-170.74662918 138.23138184 -170.74800385 139.28452576 -170.74942017 140.36958313 C-170.74582489 141.53483017 -170.74222961 142.70007721 -170.73852539 143.90063477 C-170.73867142 145.11997711 -170.73881744 146.33931946 -170.7389679 147.59561157 C-170.73838893 150.94877511 -170.73335968 154.30187774 -170.72639394 157.65503049 C-170.72015983 161.15575562 -170.71955656 164.65648148 -170.71836853 168.1572113 C-170.71525538 174.79059656 -170.70704222 181.42396541 -170.69701904 188.05734342 C-170.68585739 195.60740207 -170.68034732 203.15746149 -170.67532361 210.70752633 C-170.66485959 226.24252706 -170.64726047 241.77751142 -170.625 257.3125 C-168.35617913 258.15169398 -166.08522973 258.98401724 -163.8125 259.8125 C-163.16990234 260.05097656 -162.52730469 260.28945313 -161.86523438 260.53515625 C-158.97566261 261.58318746 -156.72423939 262.3125 -153.625 262.3125 C-153.625 271.2225 -153.625 280.1325 -153.625 289.3125 C-159.235 287.3325 -164.845 285.3525 -170.625 283.3125 C-170.625 315.9825 -170.625 348.6525 -170.625 382.3125 C-163.06680998 385.46174584 -155.59931517 388.49402855 -147.8984375 391.21875 C-146.89729416 391.57607208 -145.89615082 391.93339417 -144.8646698 392.30154419 C-142.7059959 393.07175364 -140.54683747 393.84060622 -138.38723755 394.60821533 C-132.48084108 396.70815152 -126.57862449 398.81978859 -120.67578125 400.9296875 C-119.44397629 401.36969086 -118.21217133 401.80969421 -116.94303894 402.26303101 C-104.56555683 406.68615821 -92.20048138 411.14338721 -79.84075928 415.61590576 C-77.40812851 416.49592838 -74.9752269 417.37520271 -72.54205322 418.25372314 C-59.64796524 422.90948213 -46.77440102 427.61045218 -33.94921875 432.453125 C-31.80073607 433.26100121 -29.65221806 434.06878349 -27.50366211 434.87646484 C-23.51510172 436.37647449 -19.53422033 437.89482998 -15.55688477 439.42431641 C-13.78296379 440.09343381 -12.00880802 440.76192918 -10.234375 441.4296875 C-9.4434697 441.73996887 -8.65256439 442.05025024 -7.83769226 442.36993408 C-0.15020688 445.22795129 5.36284949 443.13161855 12.80078125 440.453125 C13.6347644 440.15700317 14.46874756 439.86088135 15.32800293 439.55578613 C18.11648009 438.56347587 20.90203689 437.56323704 23.6875 436.5625 C25.68770761 435.84787953 27.6879527 435.13336392 29.68823242 434.41894531 C46.7539343 428.30925318 63.75849998 422.03466863 80.75698853 415.74087524 C94.52492576 410.64399559 108.30714323 405.59486712 122.13671875 400.66796875 C123.10370162 400.32338686 123.10370162 400.32338686 124.0902195 399.97184372 C130.91341163 397.54131806 137.73997221 395.12045607 144.56958008 392.70800781 C145.69922684 392.30753738 146.8288736 391.90706696 147.99275208 391.49446106 C150.08491236 390.75283975 152.17808298 390.01405913 154.27250671 389.27885437 C155.6806237 388.77911858 155.6806237 388.77911858 157.1171875 388.26928711 C158.32157471 387.84467445 158.32157471 387.84467445 159.55029297 387.41148376 C163.55060969 385.85511594 167.45254287 384.05581428 171.375 382.3125 C171.375 349.6425 171.375 316.9725 171.375 283.3125 C161.7585947 285.99178968 161.7585947 285.99178968 154.375 289.3125 C154.375 280.4025 154.375 271.4925 154.375 262.3125 C156.355 261.9825 158.335 261.6525 160.375 261.3125 C165.82 259.3325 165.82 259.3325 171.375 257.3125 C171.375 216.0625 171.375 174.8125 171.375 132.3125 C166.53614232 130.49792837 161.8682795 128.78313598 156.95239258 127.28564453 C155.73169571 126.91243073 154.51099884 126.53921692 153.25331116 126.1546936 C151.92539953 125.75151712 150.59747239 125.34839175 149.26953125 124.9453125 C147.85482735 124.5138395 146.4401919 124.08214198 145.02561951 123.65023804 C141.20852201 122.48548851 137.39046793 121.32390463 133.57221985 120.16293335 C129.56224854 118.94309743 125.55314962 117.72040082 121.54394531 116.49804688 C114.01358863 114.20263272 106.48241866 111.90989906 98.95093346 109.61819077 C90.74617334 107.12148122 82.54236369 104.62165624 74.33858299 102.1217308 C67.43427167 100.01794364 60.52965999 97.91514251 53.625 95.8125 C52.90169621 95.59222389 52.17839241 95.37194778 51.43317032 95.14499664 C44.06262196 92.90046388 36.69152035 90.65781202 29.31835938 88.421875 C24.92067305 87.08816284 20.52619839 85.744777 16.13476562 84.390625 C14.31381676 83.83328538 12.49285434 83.27599004 10.671875 82.71875 C9.87090393 82.46887329 9.06993286 82.21899658 8.24468994 81.96154785 C2.35484845 80.16859713 -1.59630959 80.1494579 -7.43481445 81.95117188 Z " fill="#1DD782" transform="translate(255.625,-0.3125)"/>
<path d="M0 0 C7.87470735 6.74974916 7.87470735 6.74974916 10.59968567 9.48616028 C11.22065125 10.10719635 11.84161682 10.72823242 12.48139954 11.36808777 C13.13569443 12.02754898 13.78998932 12.68701019 14.46411133 13.36645508 C15.17393158 14.0777356 15.88375183 14.78901611 16.61508179 15.52185059 C18.14393638 17.05448868 19.67163544 18.58828018 21.19828224 20.12311745 C23.61235987 22.550021 26.02960249 24.973732 28.44767761 27.39665222 C33.57210143 32.53246426 38.69257259 37.67220597 43.8125 42.8125 C49.76370596 48.78729102 55.71651249 54.76046881 61.67352867 60.72946739 C64.05871434 63.12115082 66.44087797 65.51581702 68.82295227 67.91059875 C70.27610827 69.36738504 71.72940358 70.82403236 73.18286133 72.28051758 C73.84727737 72.95009995 74.51169342 73.61968231 75.19624329 74.30955505 C75.80310974 74.916492 76.4099762 75.52342896 77.03523254 76.14875793 C77.56262433 76.67837033 78.09001612 77.20798273 78.63338947 77.75364399 C79.99963721 79.11326821 79.99963721 79.11326821 82 80 C82.59765625 82.1875 82.59765625 82.1875 83.0625 85 C83.21847656 85.9075 83.37445313 86.815 83.53515625 87.75 C84.60591661 95.23632452 85.16558368 102.56840911 85.203125 110.1328125 C85.21018463 111.07916061 85.21724426 112.02550873 85.22451782 113.00053406 C85.45241099 152.51652112 85.45241099 152.51652112 82 169 C81.70198486 170.46228027 81.70198486 170.46228027 81.39794922 171.95410156 C71.27732806 220.3359774 49.3608123 264.32428269 15 300 C14.36787598 300.65935547 13.73575195 301.31871094 13.08447266 301.99804688 C3.94002521 311.48630305 -5.35734009 320.2262044 -16 328 C-17.15105017 328.85806152 -18.30209177 329.71613451 -19.453125 330.57421875 C-27.64275981 336.61177396 -36.14538276 341.99457302 -45 347 C-45.70721191 347.4021875 -46.41442383 347.804375 -47.14306641 348.21875 C-70.27845836 361.2441741 -95.44962409 369.99301461 -121.4375 375.3125 C-122.15639404 375.45985596 -122.87528809 375.60721191 -123.6159668 375.7590332 C-138.29160498 378.54840125 -152.81668838 379.34892619 -167.72729492 379.31567383 C-170.66688487 379.3125221 -173.6054558 379.33604926 -176.54492188 379.36132812 C-186.40860919 379.39909243 -196.20955195 379.04310695 -206.01953125 377.98046875 C-206.92007736 377.90588943 -207.82062347 377.83131012 -208.74845886 377.75447083 C-213.39454178 377.16274272 -216.11999217 376.36804896 -219.0713501 372.63887024 C-223.8786457 366.86881751 -229.22068241 361.6474709 -234.53491211 356.3515625 C-235.68885435 355.19790283 -236.84257546 354.04402193 -237.99609375 352.88993835 C-241.10698202 349.77876484 -244.22092938 346.67066995 -247.33546138 343.56314468 C-250.59772125 340.30716393 -253.85712272 337.04832427 -257.11683655 333.78979492 C-263.28051719 327.6292142 -269.44674103 321.47118562 -275.61389691 315.31408405 C-282.63888514 308.30029864 -289.6610118 301.28365123 -296.68290699 294.26676941 C-311.11877024 279.84134021 -325.55819914 265.4194847 -340 251 C-338 250 -338 250 -335.83398438 250.57363892 C-334.47756836 251.06820084 -334.47756836 251.06820084 -333.09375 251.57275391 C-332.05758041 251.94632523 -331.02141083 252.31989655 -329.95384216 252.70478821 C-328.81407425 253.12447372 -327.67430634 253.54415924 -326.5 253.9765625 C-325.30677628 254.40909836 -324.11355255 254.84163422 -322.88417053 255.28727722 C-319.60594249 256.47570088 -316.33117061 257.67339767 -313.05690384 258.87268448 C-309.60558997 260.13500746 -306.15119221 261.38883083 -302.69702148 262.64331055 C-297.68614351 264.46396665 -292.67626624 266.28733085 -287.6676054 268.11407757 C-279.00438501 271.27356932 -270.33433616 274.41370343 -261.66015625 277.54296875 C-259.20474171 278.42933179 -256.74933796 279.31572473 -254.29394531 280.20214844 C-250.68368047 281.50544007 -247.07336234 282.80858184 -243.46276855 284.11096191 C-230.73041271 288.70606849 -218.01908685 293.34728768 -205.35546875 298.12890625 C-203.20242898 298.938492 -201.04935366 299.74798322 -198.89624023 300.55737305 C-194.90116691 302.05981889 -190.91375635 303.58056375 -186.92993164 305.11254883 C-185.15666164 305.7814219 -183.38315693 306.4496732 -181.609375 307.1171875 C-180.81850998 307.42745377 -180.02764496 307.73772003 -179.21281433 308.05738831 C-171.52526074 310.91543223 -166.01222473 308.81914528 -158.57421875 306.140625 C-157.7402356 305.84450317 -156.90625244 305.54838135 -156.04699707 305.24328613 C-153.25851991 304.25097587 -150.47296311 303.25073704 -147.6875 302.25 C-145.68729239 301.53537953 -143.6870473 300.82086392 -141.68676758 300.10644531 C-124.62144333 293.99688838 -107.61810503 287.72037596 -90.61901855 281.42938232 C-69.37212255 273.56824062 -48.06306302 265.89588734 -26.7175293 258.30761719 C-25.0203476 257.70419998 -25.0203476 257.70419998 -23.28887939 257.08859253 C-21.18928997 256.342556 -19.08941788 255.59731425 -16.98919678 254.85305786 C-16.05037659 254.51982513 -15.1115564 254.18659241 -14.14428711 253.84326172 C-13.33914169 253.557966 -12.53399628 253.27267029 -11.70445251 252.97872925 C-8.12498627 251.68333645 -4.564282 250.33660575 -1 249 C-0.67 216.33 -0.34 183.66 0 150 C-4.95 151.98 -9.9 153.96 -15 156 C-15.66 156 -16.32 156 -17 156 C-17 147.09 -17 138.18 -17 129 C-14.751875 128.175 -12.50375 127.35 -10.1875 126.5 C-9.48391357 126.23896484 -8.78032715 125.97792969 -8.05541992 125.70898438 C-5.22363626 124.68412514 -3.03435748 124 0 124 C0 83.08 0 42.16 0 0 Z " fill="#1FB76F" transform="translate(427,133)"/>
<path d="M0 0 C1.28067549 0.38993115 2.56149208 0.77939911 3.84243774 1.16844177 C7.31442682 2.2243118 10.78446036 3.28648033 14.25419617 4.34972763 C17.91992232 5.47177182 21.58748531 6.58777899 25.25488281 7.7043457 C31.4387405 9.58783138 37.62157424 11.47464312 43.80371094 13.36376953 C57.00088319 17.39625944 70.20308273 21.4122283 83.40500069 25.42914772 C87.73904522 26.74798475 92.07274205 28.06795545 96.40607643 29.38912392 C99.13720657 30.2217714 101.86846113 31.05401018 104.59975052 31.8861351 C105.92447511 32.28978301 107.24915987 32.69356165 108.57380295 33.09747696 C116.02479541 35.36897943 123.48101547 37.62140634 130.94726562 39.84228516 C131.64988651 40.05161965 132.3525074 40.26095415 133.07641983 40.47663212 C136.44714748 41.48084574 139.81870554 42.48204577 143.19207764 43.4773407 C144.37553772 43.82940079 145.5589978 44.18146088 146.77832031 44.54418945 C148.3478244 45.00822929 148.3478244 45.00822929 149.94903564 45.48164368 C152.3046875 46.265625 152.3046875 46.265625 153.3046875 47.265625 C153.39844803 49.07617525 153.4221286 50.89039701 153.41821289 52.70336914 C153.41813736 53.86449722 153.41806183 55.02562531 153.41798401 56.22193909 C153.41282272 57.485457 153.40766144 58.74897491 153.40234375 60.05078125 C153.40022133 61.97971474 153.40022133 61.97971474 153.39805603 63.94761658 C153.39423168 67.37205943 153.38440212 70.79646009 153.37335205 74.22088623 C153.36313614 77.71300689 153.35855803 81.20513434 153.35351562 84.69726562 C153.34277977 91.55340278 153.32570434 98.40951187 153.3046875 105.265625 C125.08359354 115.53800986 96.85750194 125.7961924 68.6171875 136.015625 C43.46672155 145.11767859 43.46672155 145.11767859 18.32284546 154.23791504 C16.47129888 154.91014492 14.61960005 155.58195567 12.76773071 156.2532959 C11.04656169 156.87732936 9.32570879 157.50223559 7.60520935 158.12811279 C6.0031561 158.70963056 4.3998111 159.28760467 2.7950592 159.8616333 C-0.65516036 161.10492475 -4.04448552 162.38794015 -7.38037109 163.9140625 C-8.47816895 164.40132812 -9.5759668 164.88859375 -10.70703125 165.390625 C-11.61283936 165.82632813 -12.51864746 166.26203125 -13.4519043 166.7109375 C-22.00813982 168.17422445 -31.74724948 162.91018164 -39.65625 159.94140625 C-40.78282013 159.52328171 -41.90939026 159.10515717 -43.07009888 158.67436218 C-46.10712515 157.54693419 -49.14271325 156.4157278 -52.17788696 155.2833252 C-57.989823 153.11754464 -63.80765155 150.96759586 -69.625 148.81640625 C-70.27278664 148.57672245 -70.92057327 148.33703865 -71.58798981 148.09009171 C-83.42161144 143.71330847 -95.29562611 139.4590009 -107.1953125 135.265625 C-124.49195092 129.16476794 -141.72235525 122.89151187 -158.93099976 116.54760742 C-160.87461912 115.83114527 -162.81840338 115.11513192 -164.76220703 114.39916992 C-168.3799742 113.06629843 -171.99675894 111.7307771 -175.61328125 110.39453125 C-177.25353523 109.78950523 -177.25353523 109.78950523 -178.92692566 109.17225647 C-180.42332329 108.61821388 -180.42332329 108.61821388 -181.94995117 108.05297852 C-183.25859383 107.56910423 -183.25859383 107.56910423 -184.59367371 107.07545471 C-186.6953125 106.265625 -186.6953125 106.265625 -188.6953125 105.265625 C-188.6953125 86.125625 -188.6953125 66.985625 -188.6953125 47.265625 C-183.90825742 45.47047934 -179.29344935 43.768132 -174.43139648 42.28637695 C-173.24262405 41.92274048 -172.05385162 41.559104 -170.82905579 41.18444824 C-169.53318887 40.79088071 -168.23730511 40.3973686 -166.94140625 40.00390625 C-165.55386495 39.58057496 -164.16639022 39.15702541 -162.77897644 38.73327637 C-159.0165581 37.58487862 -155.2531642 36.43970922 -151.48957062 35.29516983 C-147.52229085 34.08812299 -143.55589266 32.87818549 -139.58935547 31.66870117 C-130.18930342 28.80321914 -120.78766807 25.94295251 -111.38568878 23.08380127 C-108.66902115 22.25762948 -105.95239436 21.43132349 -103.23577881 20.60498047 C-84.73555568 14.97766763 -66.23433752 9.35362814 -47.7311039 3.73622131 C-46.2177419 3.27677564 -44.70439377 2.8172843 -43.19106102 2.35774231 C-42.47922472 2.14159775 -41.76738842 1.92545319 -41.03398132 1.70275879 C-40.34646003 1.49380919 -39.65893873 1.28485958 -38.95058346 1.06957817 C-37.01281602 0.48229147 -35.07348309 -0.09982222 -33.13409424 -0.68173218 C-30.99649974 -1.33606958 -28.86600062 -2.01471968 -26.74822998 -2.73062134 C-17.07050646 -5.94997446 -9.46564841 -2.91217094 0 0 Z " fill="#414952" transform="translate(273.6953125,84.734375)"/>
<path d="M0 0 C0 5.28 0 10.56 0 16 C-2.248125 16.825 -4.49625 17.65 -6.8125 18.5 C-7.86787964 18.89155273 -7.86787964 18.89155273 -8.94458008 19.29101562 C-11.77636374 20.31587486 -13.96564252 21 -17 21 C-17 29.91 -17 38.82 -17 48 C-12.15201498 46.02918697 -12.15201498 46.02918697 -7.30712891 44.05078125 C-2.22222222 42 -2.22222222 42 0 42 C0 74.67 0 107.34 0 141 C-13.49671133 146.62362972 -13.49671133 146.62362972 -18.33276367 148.34570312 C-19.98066139 148.93537369 -19.98066139 148.93537369 -21.66184998 149.53695679 C-23.39737877 150.15288193 -23.39737877 150.15288193 -25.16796875 150.78125 C-26.42969165 151.23188958 -27.69128987 151.68287837 -28.95277405 152.13418579 C-31.63477065 153.09326019 -34.3173289 154.05073788 -37.00036621 155.00689697 C-44.17927179 157.56584005 -51.35362158 160.13750511 -58.52734375 162.7109375 C-59.25792622 162.97295834 -59.98850868 163.23497917 -60.74123001 163.50494003 C-75.9427243 168.95919533 -91.10179314 174.52453239 -106.25 180.125 C-110.89182628 181.84011669 -115.5337631 183.55493394 -120.17578125 185.26953125 C-121.27119232 185.67417099 -122.36660339 186.07881073 -123.49520874 186.49571228 C-133.01502867 190.01011195 -142.5428782 193.50194496 -152.08361816 196.95916748 C-153.63358929 197.52106517 -155.18316104 198.08406595 -156.7322998 198.64825439 C-158.79823944 199.40026193 -160.86562402 200.14812783 -162.93359375 200.89453125 C-164.06853271 201.30550049 -165.20347168 201.71646973 -166.37280273 202.13989258 C-169 203 -169 203 -171 203 C-171 170.33 -171 137.66 -171 104 C-144 94 -144 94 -141 94 C-141 85.09 -141 76.18 -141 67 C-143.99707031 68.0828125 -143.99707031 68.0828125 -147.0546875 69.1875 C-148.98719454 69.88324907 -150.92009026 70.57790765 -152.85302734 71.27246094 C-154.19783932 71.75634643 -155.54224328 72.24136744 -156.88623047 72.72753906 C-158.81632453 73.42550666 -160.74784137 74.11939898 -162.6796875 74.8125 C-164.42354736 75.44091797 -164.42354736 75.44091797 -166.20263672 76.08203125 C-169 77 -169 77 -171 77 C-171 72.05 -171 67.1 -171 62 C-162.70271897 58.47363601 -154.35967571 55.24095166 -145.8671875 52.21875 C-144.60819664 51.76806506 -143.34931405 51.31707757 -142.0905304 50.86581421 C-139.41311651 49.90655587 -136.73506924 48.9490969 -134.05648804 47.99310303 C-129.80505242 46.47558928 -125.55529655 44.95341162 -121.3059082 43.43017578 C-120.58771062 43.17273905 -119.86951303 42.91530231 -119.12955189 42.65006447 C-117.66883002 42.12645596 -116.20811412 41.60283084 -114.7474041 41.0791893 C-112.53401459 40.2858531 -110.32049579 39.49287853 -108.10694885 38.69998169 C-93.45744062 33.45174227 -78.81978185 28.17106804 -64.1875 22.875 C-62.38765656 22.22393784 -62.38765656 22.22393784 -60.55145264 21.5597229 C-44.22102005 15.65037967 -27.9128925 9.68481385 -11.66479492 3.55224609 C-10.67910774 3.1821064 -10.67910774 3.1821064 -9.67350769 2.80448914 C-7.95458369 2.15883736 -6.23699564 1.50963188 -4.51953125 0.86010742 C-2 0 -2 0 0 0 Z " fill="#23272B" transform="translate(427,241)"/>
<path d="M0 0 C1.65109268 0.50002281 1.65109268 0.50002281 3.33554077 1.01014709 C4.52402618 1.37579269 5.7125116 1.74143829 6.93701172 2.11816406 C8.2176872 2.50809521 9.49850379 2.89756317 10.77944946 3.28660583 C14.25143854 4.34247587 17.72147208 5.4046444 21.19120789 6.46789169 C24.85693404 7.58993588 28.52449703 8.70594305 32.19189453 9.82250977 C38.37575222 11.70599544 44.55858596 13.59280718 50.74072266 15.48193359 C63.93789491 19.5144235 77.14009445 23.53039236 90.34201241 27.54731178 C94.67605086 28.86614696 99.00973845 30.18612622 103.34307289 31.50727272 C121.96089908 37.18343819 140.59369182 42.80753483 159.24169922 48.38378906 C159.24169922 49.04378906 159.24169922 49.70378906 159.24169922 50.38378906 C112.51985317 67.39038649 112.51985317 67.39038649 89.60888672 75.68457031 C87.82555435 76.33027733 87.82555435 76.33027733 86.00619507 76.98902893 C80.02570194 79.15392836 74.04430736 81.31629256 68.06152344 83.47485352 C56.19902299 87.75784475 44.3499168 92.0729539 32.52659607 96.46277618 C28.07470949 98.11383007 23.61928703 99.7553363 19.16455078 101.39868164 C16.73425609 102.29865317 14.30583063 103.20369015 11.87939453 104.11401367 C8.53070074 105.37012374 5.1761271 106.6091208 1.81982422 107.84472656 C0.83201965 108.22063934 -0.15578491 108.59655212 -1.17352295 108.9838562 C-2.08934143 109.31741119 -3.00515991 109.65096619 -3.94873047 109.99462891 C-5.13193878 110.43589615 -5.13193878 110.43589615 -6.33905029 110.88607788 C-11.27197533 111.90092606 -15.78875143 110.15783276 -20.40991211 108.4921875 C-21.50900909 108.09875656 -22.60810608 107.70532562 -23.74050903 107.29997253 C-24.92845062 106.86872574 -26.11639221 106.43747894 -27.34033203 105.99316406 C-28.60995435 105.5362086 -29.87972332 105.07966044 -31.14962769 104.62348938 C-34.57737148 103.39054667 -38.00265504 102.15089936 -41.4274559 100.90980911 C-44.30464206 99.86809428 -47.18324913 98.83033625 -50.06181431 97.79243946 C-70.72910056 90.33908091 -91.35301609 82.77090456 -111.95788574 75.14675903 C-134.81971981 66.6885207 -157.76472145 58.47634581 -180.75830078 50.38378906 C-180.75830078 49.72378906 -180.75830078 49.06378906 -180.75830078 48.38378906 C-179.74785454 48.07789604 -179.74785454 48.07789604 -178.71699524 47.76582336 C-169.8346986 45.07674385 -160.95265866 42.38681736 -152.07080078 39.69628906 C-151.34110706 39.47524757 -150.61141335 39.25420609 -149.8596077 39.02646637 C-124.55909562 31.36201543 -99.26501002 23.67660138 -73.97622681 15.97354126 C-73.29266711 15.76533532 -72.60910742 15.55712938 -71.90483379 15.34261417 C-70.5386936 14.92643973 -69.17258489 14.51016197 -67.80650806 14.09377956 C-64.47423186 13.07829917 -61.14137955 12.06480139 -57.80714417 11.05577087 C-51.51231324 9.14892127 -45.22503076 7.22293211 -38.95402813 5.23889732 C-35.92556468 4.28237609 -32.89376305 3.33671054 -29.86155891 2.39212418 C-28.4165155 1.93878338 -26.97307018 1.48031201 -25.53140068 1.01635361 C-23.5315747 0.37317899 -21.52686842 -0.2518891 -19.52026367 -0.87353516 C-17.81115562 -1.41553055 -17.81115562 -1.41553055 -16.06752014 -1.96847534 C-10.41368729 -3.07513779 -5.41830292 -1.65456217 0 0 Z " fill="#414952" transform="translate(266.75830078125,82.6162109375)"/>
<path d="M0 0 C11.24855651 3.37456695 11.24855651 3.37456695 15.21606445 4.82739258 C16.1218927 5.15741272 17.02772095 5.48743286 17.96099854 5.82745361 C18.91875183 6.17958923 19.87650513 6.53172485 20.86328125 6.89453125 C21.90425964 7.27446228 22.94523804 7.65439331 24.01776123 8.0458374 C26.27059188 8.86831253 28.52296796 9.69203361 30.77493286 10.51687622 C36.26525453 12.52769072 41.75834666 14.53090154 47.2514782 16.53402519 C48.53766528 17.00308496 49.82381429 17.47224917 51.10992622 17.94151497 C61.11271182 21.59111991 71.12345198 25.21820291 81.140625 28.828125 C81.80799871 29.06864279 82.47537243 29.30916058 83.16296959 29.55696678 C89.04237394 31.67559396 94.922367 33.79258294 100.80288696 35.90811157 C115.74512587 41.28376664 130.67341712 46.69452602 145.57545471 52.18055725 C147.89306973 53.03302272 150.21374143 53.87722933 152.53756714 54.71261597 C154.92509501 55.60033434 157.29149853 56.54628612 159.63748169 57.53860474 C166.32658665 60.25999934 170.746209 61.85847112 177.59008789 59.08538818 C178.38535889 58.72721008 179.18062988 58.36903198 180 58 C181.75074869 57.37480965 183.50551154 56.76077152 185.26367188 56.15673828 C187.16641099 55.46413099 189.06805062 54.7684979 190.96875 54.0703125 C192.0172966 53.68787384 193.0658432 53.30543518 194.14616394 52.91140747 C196.41205244 52.08463123 198.67747474 51.25657643 200.94247437 50.42736816 C206.46226932 48.40663635 211.9848647 46.39358329 217.50711632 44.37957764 C219.43988509 43.67454271 221.37252084 42.96914417 223.30513 42.26367188 C238.30266806 36.78998562 253.31653989 31.36149593 268.33041382 25.93280029 C280.97959027 21.35884241 293.62576746 16.77734043 306.2578125 12.15625 C308.32201072 11.40198878 310.38621942 10.64775622 312.45043945 9.89355469 C316.25773648 8.50234194 320.0632997 7.10652172 323.86791992 5.70800781 C325.55380932 5.09162075 327.23975928 4.47539933 328.92578125 3.859375 C330.05422958 3.44226257 330.05422958 3.44226257 331.20547485 3.01672363 C334.83264467 1.69591991 338.19032711 0.76193458 342 0 C342 16.83 342 33.66 342 51 C331.62950089 55.03297187 321.30124107 59.04804225 310.83203125 62.79296875 C309.65279083 63.21710052 308.47355042 63.6412323 307.25857544 64.07821655 C304.74449569 64.9822506 302.23015671 65.8855143 299.71530151 66.78738403 C293.65436517 68.96111262 287.59608861 71.1422376 281.53763771 73.3228817 C280.15112012 73.821907 278.76457294 74.32085009 277.37799644 74.81971169 C264.0405918 79.61833673 250.71686475 84.45384515 237.39813232 89.30407715 C233.96408445 90.55283284 230.52843682 91.79708521 227.09228516 93.04003906 C217.89154069 96.37170883 208.6964687 99.70745134 199.56480408 103.22492981 C196.21077026 104.51589018 192.84954053 105.78743999 189.48757935 107.05758667 C187.27498008 107.90403381 185.0764243 108.78114433 182.87670898 109.66040039 C181.55778179 110.15944379 180.23824075 110.65686914 178.91796875 111.15234375 C177.81219482 111.58538818 176.7064209 112.01843262 175.56713867 112.46459961 C170.45950965 113.23121589 166.78277495 111.74576485 162 110 C161.01872635 109.65981339 160.0374527 109.31962677 159.02644348 108.96913147 C155.66139511 107.7953106 152.3088128 106.5900739 148.95703125 105.37890625 C147.68735139 104.92218982 146.41759421 104.46568827 145.14776611 104.00938416 C141.74277896 102.78499481 138.33903178 101.55719364 134.93556595 100.32858276 C132.07659836 99.29695876 129.2169459 98.26724029 126.35731411 97.23745918 C99.59783679 87.6003525 72.8630141 77.89540683 46.1439209 68.14691162 C42.99097991 66.99670945 39.83780263 65.84715715 36.68457031 64.69775391 C31.75914373 62.90216701 26.83425374 61.10511725 21.90988159 59.30664062 C20.11322802 58.65055101 18.31645715 57.99478253 16.51956177 57.33935547 C14.08942361 56.4526971 11.65985639 55.56449357 9.23046875 54.67578125 C8.51883575 54.41642288 7.80720276 54.15706451 7.07400513 53.8898468 C2.2292559 52.11462795 2.2292559 52.11462795 0 51 C0 34.17 0 17.34 0 0 Z " fill="#FDA326" transform="translate(85,190)"/>
<path d="M0 0 C0 19.14 0 38.28 0 58 C-28.22226206 68.26935714 -56.44696088 78.53107419 -84.6875 88.75 C-105.09545078 96.13470647 -125.49814701 103.53362616 -145.89204407 110.95706177 C-147.48906925 111.53811496 -149.08629911 112.11860597 -150.6837616 112.69845581 C-153.9654843 113.89034368 -157.24263661 115.09090861 -160.51220703 116.31591797 C-161.99309814 116.86916748 -161.99309814 116.86916748 -163.50390625 117.43359375 C-164.31802979 117.74224365 -165.13215332 118.05089355 -165.97094727 118.36889648 C-168 119 -168 119 -171 119 C-171 100.19 -171 81.38 -171 62 C-148.55726351 53.68787538 -126.07971532 45.48271659 -103.5625 37.375 C-98.32020957 35.4872649 -93.07798222 33.59935482 -87.8359375 31.7109375 C-87.18225819 31.47545574 -86.52857887 31.23997398 -85.85509109 30.99735641 C-71.12354731 25.6896839 -56.40368997 20.35008219 -41.6875 15 C-40.54499786 14.5849823 -39.40249573 14.1699646 -38.22537231 13.74237061 C-21.84004505 7.79421583 -21.84004505 7.79421583 -5.51823425 1.67456055 C-1.10394592 0 -1.10394592 0 0 0 Z " fill="#23272B" transform="translate(427,132)"/>
<path d="M0 0 C0 37.62 0 75.24 0 114 C-11.24906786 110.62527964 -11.24906786 110.62527964 -15.26367188 109.15673828 C-16.17914795 108.82350052 -17.09462402 108.49026276 -18.0378418 108.14692688 C-19.0050415 107.79164413 -19.97224121 107.43636139 -20.96875 107.0703125 C-22.54136597 106.49672249 -22.54136597 106.49672249 -24.14575195 105.9115448 C-26.41150231 105.0848121 -28.67678728 104.25680308 -30.94165039 103.42764282 C-36.4652466 101.40556131 -41.9917008 99.39131681 -47.51777649 97.37602425 C-49.45152462 96.6706656 -51.38514009 95.96494437 -53.31872559 95.25914001 C-67.03693765 90.25240098 -80.7678525 85.28088215 -94.5 80.3125 C-96.91065193 79.44004323 -99.32129649 78.5675661 -101.73193359 77.69506836 C-108.82107048 75.12944127 -115.91050959 72.56465002 -123 70 C-125.37272251 69.14160476 -127.74544387 68.28320633 -130.11816406 67.42480469 C-143.41175499 62.61555641 -156.70568921 57.80725797 -170 53 C-170 52.34 -170 51.68 -170 51 C-168.98955376 50.69410698 -168.98955376 50.69410698 -167.95869446 50.3820343 C-159.07639782 47.69295479 -150.19435788 45.0030283 -141.3125 42.3125 C-140.58280628 42.09145851 -139.85311256 41.87041702 -139.10130692 41.64267731 C-111.74302609 33.35485291 -84.39290131 25.04040983 -57.04752064 16.71012783 C-53.71847465 15.69607338 -50.38929977 14.68244583 -47.05982971 13.66978455 C-46.41059445 13.47231849 -45.7613592 13.27485243 -45.09245014 13.07140255 C-43.7775401 12.67148179 -42.46262348 12.27158264 -41.14770031 11.87170506 C-36.78633429 10.54490071 -32.42628205 9.21384553 -28.06679058 7.88089561 C-24.98789668 6.94003359 -21.90831568 6.00143468 -18.82859993 5.06326675 C-17.35073084 4.6125058 -15.8731605 4.16076409 -14.39590263 3.708004 C-12.3559274 3.08290528 -10.31494032 2.46122455 -8.27368164 1.84033203 C-6.52529747 1.30619186 -6.52529747 1.30619186 -4.74159241 0.76126099 C-2 0 -2 0 0 0 Z " fill="#626977" transform="translate(256,80)"/>
<path d="M0 0 C11.24855651 3.37456695 11.24855651 3.37456695 15.21606445 4.82739258 C16.1218927 5.15741272 17.02772095 5.48743286 17.96099854 5.82745361 C18.91875183 6.17958923 19.87650513 6.53172485 20.86328125 6.89453125 C21.90425964 7.27446228 22.94523804 7.65439331 24.01776123 8.0458374 C26.27059188 8.86831253 28.52296796 9.69203361 30.77493286 10.51687622 C36.26525453 12.52769072 41.75834666 14.53090154 47.2514782 16.53402519 C48.53766528 17.00308496 49.82381429 17.47224917 51.10992622 17.94151497 C61.11271182 21.59111991 71.12345198 25.21820291 81.140625 28.828125 C81.80799871 29.06864279 82.47537243 29.30916058 83.16296959 29.55696678 C89.04237394 31.67559396 94.922367 33.79258294 100.80288696 35.90811157 C115.74512587 41.28376664 130.67341712 46.69452602 145.57545471 52.18055725 C152.75282059 54.82209278 152.75282059 54.82209278 159.95388794 57.39797974 C160.6002398 57.62617936 161.24659166 57.85437899 161.91252995 58.08949375 C163.71889867 58.72558752 165.52659585 59.35790509 167.33436584 59.99000549 C170 61 170 61 171 62 C171.09326716 63.56547048 171.11745582 65.13512772 171.11352539 66.70336914 C171.11344986 67.70433121 171.11337433 68.70529327 171.11329651 69.73658752 C171.10813522 70.8251152 171.10297394 71.91364288 171.09765625 73.03515625 C171.09553383 74.6977372 171.09553383 74.6977372 171.09336853 76.39390564 C171.08775033 79.95013069 171.07519475 83.50629383 171.0625 87.0625 C171.05748734 89.46679597 171.05292403 91.87109292 171.04882812 94.27539062 C171.03777499 100.18361504 171.02101917 106.0918031 171 112 C165.90385383 111.33801911 161.38017581 109.8713123 156.57421875 108.140625 C155.73973709 107.8443219 154.90525543 107.5480188 154.04548645 107.24273682 C151.25751719 106.25059777 148.4724628 105.25054459 145.6875 104.25 C143.69535019 103.53830596 141.70316173 102.82672007 139.7109375 102.11523438 C122.3865807 95.91327285 105.1248216 89.54208375 87.86773682 83.15582275 C69.52420156 76.36812544 51.13908794 69.71364423 32.68359375 63.23632812 C31.39230812 62.78149551 31.39230812 62.78149551 30.07493591 62.31747437 C28.53262267 61.77448085 26.98951537 61.23373088 25.44520569 60.69644165 C16.87311412 57.67703845 8.48504354 54.29973916 0 51 C0 34.17 0 17.34 0 0 Z " fill="#FDC147" transform="translate(85,190)"/>
<path d="M0 0 C4.86290375 1.39876216 9.68715313 2.82809975 14.4140625 4.640625 C15.11273438 4.90617187 15.81140625 5.17171875 16.53125 5.4453125 C17.93916561 5.9864144 19.34282201 6.53871808 20.7421875 7.1015625 C30.05663047 10.58585413 37.44420336 7.35382984 46.3125 3.9375 C48.26528861 3.19230669 50.21965155 2.45122205 52.17578125 1.71484375 C53.03083252 1.38605225 53.88588379 1.05726074 54.7668457 0.71850586 C57 0 57 0 60 0 C60 8.91 60 17.82 60 27 C56.14533606 28.4573447 52.28885437 29.90424281 48.42163086 31.32739258 C47.1093014 31.813602 45.7990214 32.30538293 44.4909668 32.80297852 C42.60206073 33.52040303 40.70650532 34.21696232 38.80859375 34.91015625 C37.67220459 35.33433838 36.53581543 35.75852051 35.36499023 36.19555664 C29.50399848 37.59670065 24.61309324 36.06152611 19.1015625 33.96875 C18.04582031 33.57042969 16.99007812 33.17210937 15.90234375 32.76171875 C14.28005859 32.13716797 14.28005859 32.13716797 12.625 31.5 C10.96791016 30.87544922 10.96791016 30.87544922 9.27734375 30.23828125 C1.14885603 27.14885603 1.14885603 27.14885603 0 26 C-0.08748207 24.07332493 -0.10697334 22.14348139 -0.09765625 20.21484375 C-0.09443359 19.04501953 -0.09121094 17.87519531 -0.08789062 16.66992188 C-0.07951172 15.43822266 -0.07113281 14.20652344 -0.0625 12.9375 C-0.05798828 11.70193359 -0.05347656 10.46636719 -0.04882812 9.19335938 C-0.03699608 6.12885883 -0.02051173 3.06445279 0 0 Z " fill="#FCA326" transform="translate(226,308)"/>
<path d="M0 0 C0 8.58 0 17.16 0 26 C-3.75375 27.423125 -7.5075 28.84625 -11.375 30.3125 C-12.53692871 30.75505127 -13.69885742 31.19760254 -14.89599609 31.65356445 C-16.32032959 32.19049927 -16.32032959 32.19049927 -17.7734375 32.73828125 C-18.72653809 33.09962158 -19.67963867 33.46096191 -20.66162109 33.83325195 C-25.05882122 35.37005314 -29.53842843 36.66152853 -34 38 C-34 29.42 -34 20.84 -34 12 C-27.22535844 8.9890482 -20.57170977 6.26759951 -13.625 3.75 C-12.64144531 3.38648438 -11.65789062 3.02296875 -10.64453125 2.6484375 C-9.70222656 2.30554688 -8.75992187 1.96265625 -7.7890625 1.609375 C-6.94037598 1.29967773 -6.09168945 0.98998047 -5.21728516 0.67089844 C-3 0 -3 0 0 0 Z " fill="#FAA126" transform="translate(339,289)"/>
<path d="M0 0 C4.03254987 0.69377202 7.72729494 1.87462583 11.578125 3.25 C12.82078125 3.6934375 14.0634375 4.136875 15.34375 4.59375 C15.98441406 4.82449219 16.62507813 5.05523437 17.28515625 5.29296875 C19.25612729 6.00220485 21.22944763 6.70458516 23.203125 7.40625 C32.87033279 10.87033279 32.87033279 10.87033279 34 12 C34.08748207 13.92667507 34.10697334 15.85651861 34.09765625 17.78515625 C34.09443359 18.95498047 34.09121094 20.12480469 34.08789062 21.33007812 C34.07532227 23.17762695 34.07532227 23.17762695 34.0625 25.0625 C34.05798828 26.29806641 34.05347656 27.53363281 34.04882812 28.80664062 C34.03699608 31.87114117 34.02051173 34.93554721 34 38 C26.29206011 36.02732509 18.83634351 33.63135559 11.375 30.875 C10.38371094 30.51535156 9.39242187 30.15570313 8.37109375 29.78515625 C1.13484172 27.13484172 1.13484172 27.13484172 0 26 C-0.08748207 24.07332493 -0.10697334 22.14348139 -0.09765625 20.21484375 C-0.09443359 19.04501953 -0.09121094 17.87519531 -0.08789062 16.66992188 C-0.07951172 15.43822266 -0.07113281 14.20652344 -0.0625 12.9375 C-0.05798828 11.70193359 -0.05347656 10.46636719 -0.04882812 9.19335938 C-0.03699608 6.12885883 -0.02051173 3.06445279 0 0 Z " fill="#FBBF47" transform="translate(173,289)"/>
<path d="M0 0 C0 8.58 0 17.16 0 26 C-7.74780049 29.2282502 -15.30165333 32.23635858 -23.25 34.8125 C-26.4675 35.864375 -29.685 36.91625 -33 38 C-33 29.09 -33 20.18 -33 11 C-28.78405787 9.42890481 -24.56723819 7.86083242 -20.34741211 6.30029297 C-18.91219237 5.7685138 -17.47761561 5.2349959 -16.04370117 4.69970703 C-13.98262399 3.93063773 -11.91931608 3.16784904 -9.85546875 2.40625 C-9.21473923 2.16563843 -8.5740097 1.92502686 -7.91386414 1.67712402 C-5.11647059 0.65102595 -3.00836132 0 0 0 Z " fill="#FCA226" transform="translate(391,270)"/>
<path d="M0 0 C7.73875274 1.97421993 15.2057523 4.40189579 22.6875 7.1875 C26.090625 8.445625 29.49375 9.70375 33 11 C33 19.91 33 28.82 33 38 C21.73048907 34.61914672 21.73048907 34.61914672 17.24609375 32.9921875 C15.81233398 32.47205078 15.81233398 32.47205078 14.34960938 31.94140625 C12.90811523 31.41353516 12.90811523 31.41353516 11.4375 30.875 C10.44169922 30.51535156 9.44589844 30.15570313 8.41992188 29.78515625 C7.47568359 29.44097656 6.53144531 29.09679687 5.55859375 28.7421875 C4.70579834 28.4313623 3.85300293 28.12053711 2.97436523 27.80029297 C1 27 1 27 0 26 C-0.08748207 24.07332493 -0.10697334 22.14348139 -0.09765625 20.21484375 C-0.09443359 19.04501953 -0.09121094 17.87519531 -0.08789062 16.66992188 C-0.07951172 15.43822266 -0.07113281 14.20652344 -0.0625 12.9375 C-0.05798828 11.70193359 -0.05347656 10.46636719 -0.04882812 9.19335938 C-0.03699608 6.12885883 -0.02051173 3.06445279 0 0 Z " fill="#FCC047" transform="translate(121,270)"/>
<path d="M0 0 C6.78945352 1.95792256 13.44036454 4.16192046 20.0625 6.625 C20.91521484 6.93695313 21.76792969 7.24890625 22.64648438 7.5703125 C28.8720271 9.8720271 28.8720271 9.8720271 30 11 C30.08748207 12.92667507 30.10697334 14.85651861 30.09765625 16.78515625 C30.09443359 17.95498047 30.09121094 19.12480469 30.08789062 20.33007812 C30.07951172 21.56177734 30.07113281 22.79347656 30.0625 24.0625 C30.05798828 25.29806641 30.05347656 26.53363281 30.04882812 27.80664062 C30.03699608 30.87114117 30.02051173 33.93554721 30 37 C23.21054648 35.04207744 16.55963546 32.83807954 9.9375 30.375 C9.08478516 30.06304687 8.23207031 29.75109375 7.35351562 29.4296875 C1.1279729 27.1279729 1.1279729 27.1279729 0 26 C-0.08748207 24.07332493 -0.10697334 22.14348139 -0.09765625 20.21484375 C-0.09443359 19.04501953 -0.09121094 17.87519531 -0.08789062 16.66992188 C-0.07951172 15.43822266 -0.07113281 14.20652344 -0.0625 12.9375 C-0.05798828 11.70193359 -0.05347656 10.46636719 -0.04882812 9.19335938 C-0.03699608 6.12885883 -0.02051173 3.06445279 0 0 Z " fill="#FCC047" transform="translate(226,308)"/>
<path d="M0 0 C5.79197795 1.15839559 11.39642971 3.13214324 17 5 C17 13.91 17 22.82 17 32 C7 29 7 29 0 26 C0 17.42 0 8.84 0 0 Z " fill="#F7BF48" transform="translate(85,257)"/>
<path d="M0 0 C0 8.58 0 17.16 0 26 C-2.43375 26.99 -4.8675 27.98 -7.375 29 C-8.13989746 29.31324219 -8.90479492 29.62648438 -9.69287109 29.94921875 C-14.77777778 32 -14.77777778 32 -17 32 C-17 23.09 -17 14.18 -17 5 C-14.751875 4.175 -12.50375 3.35 -10.1875 2.5 C-9.13212036 2.10844727 -9.13212036 2.10844727 -8.05541992 1.70898438 C-5.22363626 0.68412514 -3.03435748 0 0 0 Z " fill="#F6A027" transform="translate(427,257)"/></svg>
);

const CompassNeedleIcon = ({ isAligned = false }: { isAligned?: boolean }) => (
    <svg width="28" height="44" viewBox="0 0 28 44" className="drop-shadow-xl">
        {/* Needle shadow */}
        <ellipse cx="14" cy="42" rx="6" ry="2" fill="rgba(0,0,0,0.2)" />
        
        {/* Main needle body */}
        <path
            d="M14 2 L22 18 L14 14 L6 18 Z"
            fill={isAligned ? "#10b981" : "#ef4444"}
            className="transition-colors duration-300"
        />
        <path
            d="M14 2 L14 14 L6 18 Z"
            fill={isAligned ? "#059669" : "#dc2626"}
            className="transition-colors duration-300"
        />
        
        {/* Needle stem */}
        <rect
            x="11"
            y="16"
            width="6"
            height="22"
            rx="3"
            fill={isAligned ? "#10b981" : "#6b7280"}
            className="transition-colors duration-300"
        />
        <rect
            x="11"
            y="16"
            width="3"
            height="22"
            rx="1.5"
            fill={isAligned ? "#059669" : "#4b5563"}
            className="transition-colors duration-300"
        />
        
        {/* Highlight on needle */}
        <path
            d="M14 4 L18 14 L14 12 Z"
            fill="rgba(255,255,255,0.3)"
        />
    </svg>
);

const LocationPinIcon = ({ className = "" }: { className?: string }) => (
    <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
        <circle cx="12" cy="10" r="3" />
    </svg>
);

const CheckIcon = ({ className = "" }: { className?: string }) => (
    <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="20 6 9 17 4 12" />
    </svg>
);

const RotateIcon = ({ className = "", style }: { className?: string; style?: React.CSSProperties }) => (
    <svg className={className} style={style} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 2v6h-6" />
        <path d="M3 12a9 9 0 0 1 15-6.7L21 8" />
        <path d="M3 22v-6h6" />
        <path d="M21 12a9 9 0 0 1-15 6.7L3 16" />
    </svg>
);

const ShieldCheckIcon = ({ className = "" }: { className?: string }) => (
    <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
        <polyline points="9 12 11 14 15 10" />
    </svg>
);

const InfoIcon = ({ className = "" }: { className?: string }) => (
    <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="12" cy="12" r="10" />
        <line x1="12" y1="16" x2="12" y2="12" />
        <line x1="12" y1="8" x2="12.01" y2="8" />
    </svg>
);

const QiblaPage = () => {
    const { t, setHeaderTitle, settings, formatNumber } = useAppStore();
    const [qiblaDirection, setQiblaDirection] = useState<number | null>(null);
    const [smoothedHeading, setSmoothedHeading] = useState<number>(0);
    const [permissionGranted, setPermissionGranted] = useState(false);
    const [isIOS, setIsIOS] = useState(false);
    const [isAligned, setIsAligned] = useState(false);
    const [compassError, setCompassError] = useState<string | null>(null);

    // Refs for smooth rotation handling
    const currentHeadingRef = useRef<number>(0);
    const targetHeadingRef = useRef<number>(0);
    const animationRef = useRef<number | null>(null);
    const lastUpdateTimeRef = useRef<number>(Date.now());
    const headingHistoryRef = useRef<number[]>([]);

    // Normalize angle to 0-360 range
    const normalizeAngle = useCallback((angle: number): number => {
        angle = angle % 360;
        return angle < 0 ? angle + 360 : angle;
    }, []);

    // Calculate the shortest rotation path between two angles
    const getShortestRotation = useCallback((from: number, to: number): number => {
        const diff = normalizeAngle(to - from);
        return diff > 180 ? diff - 360 : diff;
    }, [normalizeAngle]);

    // Apply median filter to reduce noise
    const applyMedianFilter = useCallback((newValue: number, history: number[], maxSize: number = 5): number => {
        const adjustedHistory = history.map(h => {
            const diff = newValue - h;
            if (diff > 180) return h + 360;
            if (diff < -180) return h - 360;
            return h;
        });
        adjustedHistory.push(newValue);

        if (adjustedHistory.length > maxSize) {
            adjustedHistory.shift();
        }

        const sorted = [...adjustedHistory].sort((a, b) => a - b);
        const median = sorted[Math.floor(sorted.length / 2)];
        return normalizeAngle(median);
    }, [normalizeAngle]);

    // Smooth animation loop
    const animateCompass = useCallback(() => {
        const now = Date.now();
        const deltaTime = Math.min((now - lastUpdateTimeRef.current) / 1000, 0.1);
        lastUpdateTimeRef.current = now;

        const current = currentHeadingRef.current;
        const target = targetHeadingRef.current;
        const diff = getShortestRotation(current, target);

        const smoothingFactor = 0.15;
        const threshold = 0.1;

        if (Math.abs(diff) > threshold) {
            const newHeading = normalizeAngle(current + diff * smoothingFactor);
            currentHeadingRef.current = newHeading;
            setSmoothedHeading(newHeading);
        }

        animationRef.current = requestAnimationFrame(animateCompass);
    }, [getShortestRotation, normalizeAngle]);

    // Start animation loop
    useEffect(() => {
        animationRef.current = requestAnimationFrame(animateCompass);
        return () => {
            if (animationRef.current) {
                cancelAnimationFrame(animationRef.current);
            }
        };
    }, [animateCompass]);

    // Handle device orientation
    const handleOrientation = useCallback((event: DeviceOrientationEvent) => {
        let heading = 0;

        if ((event as any).webkitCompassHeading !== undefined) {
            heading = (event as any).webkitCompassHeading;
        } else if (event.alpha !== null) {
            if ((event as any).absolute === true || event.absolute) {
                heading = (360 - event.alpha) % 360;
            } else {
                heading = (360 - event.alpha) % 360;
            }
        }

        headingHistoryRef.current.push(heading);
        if (headingHistoryRef.current.length > 5) {
            headingHistoryRef.current.shift();
        }
        const filteredHeading = applyMedianFilter(heading, [...headingHistoryRef.current].slice(0, -1));

        targetHeadingRef.current = filteredHeading;
    }, [applyMedianFilter]);

    const startCompass = useCallback(() => {
        if (typeof DeviceOrientationEvent !== 'undefined' &&
            typeof (DeviceOrientationEvent as any).requestPermission === 'function') {
            (DeviceOrientationEvent as any).requestPermission()
                .then((response: string) => {
                    if (response === 'granted') {
                        setPermissionGranted(true);
                        setCompassError(null);
                        window.addEventListener('deviceorientation', handleOrientation, true);
                    } else {
                        setCompassError(t('permissionDenied'));
                    }
                })
                .catch((err: Error) => {
                    console.error(err);
                    setCompassError(t('permissionFailed'));
                });
        } else {
            setPermissionGranted(true);
            if ('ondeviceorientationabsolute' in (window as any)) {
                window.addEventListener('deviceorientationabsolute' as any, handleOrientation, true);
            } else {
                window.addEventListener('deviceorientation', handleOrientation, true);
            }
        }
    }, [handleOrientation, t]);

    // Initialize compass and fetch Qibla direction
    useEffect(() => {
        setHeaderTitle(t('qibla'));

        const fetchQibla = async () => {
            try {
                const dir = await getQiblaDirection(settings.location.latitude, settings.location.longitude);
                if (dir !== null) setQiblaDirection(dir);
            } catch (error) {
                console.error('Failed to fetch Qibla direction:', error);
            }
        };
        fetchQibla();

        const isIOSDevice = /iPad|iPhone|iPod/.test(navigator.userAgent) ||
            (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
        setIsIOS(isIOSDevice);

        if (!isIOSDevice) {
            startCompass();
        }

        return () => {
            window.removeEventListener('deviceorientationabsolute' as any, handleOrientation, true);
            window.removeEventListener('deviceorientation', handleOrientation, true);
        };
    }, [t, setHeaderTitle, settings.location, handleOrientation, startCompass]);

    // Check alignment
    useEffect(() => {
        if (qiblaDirection === null) return;

        const diff = Math.abs(getShortestRotation(smoothedHeading, qiblaDirection));
        const aligned = diff < 5;

        if (aligned !== isAligned) {
            if (aligned && navigator.vibrate) {
                navigator.vibrate([50, 30, 50]);
            }
            setIsAligned(aligned);
        }
    }, [smoothedHeading, qiblaDirection, isAligned, getShortestRotation]);

    const compassRotation = -smoothedHeading;

    // Generate compass tick marks
    const ticks = useMemo(() => {
        const elements = [];
        const totalTicks = 72;

        for (let i = 0; i < totalTicks; i++) {
            const angle = i * (360 / totalTicks);
            const isCardinal = angle % 90 === 0;
            const isMajor = angle % 30 === 0;
            const isMinor = angle % 15 === 0;

            let height, width, color;
            if (isCardinal) {
                height = 16;
                width = 2.5;
                color = angle === 0 ? '#ef4444' : '#10b981';
            } else if (isMajor) {
                height = 12;
                width = 2;
                color = '#6b7280';
            } else if (isMinor) {
                height = 8;
                width = 1.5;
                color = '#9ca3af';
            } else {
                height = 5;
                width = 1;
                color = '#d1d5db';
            }

            elements.push(
                <line
                    key={i}
                    x1="150"
                    y1="20"
                    x2="150"
                    y2={20 + height}
                    stroke={color}
                    strokeWidth={width}
                    strokeLinecap="round"
                    className="dark:opacity-80"
                    transform={`rotate(${angle} 150 150)`}
                />
            );
        }
        return elements;
    }, []);

    // Cardinal direction labels with proper icons
    const cardinalLabels = useMemo(() => {
        const labels = [
            { text: 'N', angle: 0 },
            { text: 'E', angle: 90 },
            { text: 'S', angle: 180 },
            { text: 'W', angle: 270 },
        ];

        return labels.map(({ text, angle }) => {
            const radians = (angle - 90) * (Math.PI / 180);
            const radius = 115;
            const x = 150 + radius * Math.cos(radians);
            const y = 150 + radius * Math.sin(radians);

            const isNorth = angle === 0;

            return (
                <g key={text}>
                    {isNorth ? (
                        // North indicator with triangle
                        <g transform={`translate(${x}, ${y})`}>
                            <polygon
                                points="0,-12 -8,6 8,6"
                                fill="#ef4444"
                                className="drop-shadow-sm"
                            />
                            <text
                                y="2"
                                fill="white"
                                fontSize="10"
                                fontWeight="bold"
                                textAnchor="middle"
                                dominantBaseline="middle"
                            >
                                N
                            </text>
                        </g>
                    ) : (
                        <text
                            x={x}
                            y={y}
                            fill="#374151"
                            className="dark:fill-gray-300"
                            fontSize="18"
                            fontWeight="600"
                            textAnchor="middle"
                            dominantBaseline="middle"
                        >
                            {text}
                        </text>
                    )}
                </g>
            );
        });
    }, []);

    // Degree markers
    const degreeMarkers = useMemo(() => {
        const markers = [];
        for (let angle = 30; angle < 360; angle += 30) {
            if (angle % 90 !== 0) {
                const radians = (angle - 90) * (Math.PI / 180);
                const radius = 115;
                const x = 150 + radius * Math.cos(radians);
                const y = 150 + radius * Math.sin(radians);

                markers.push(
                    <text
                        key={angle}
                        x={x}
                        y={y}
                        fill="#9ca3af"
                        className="dark:fill-gray-500"
                        fontSize="11"
                        fontWeight="500"
                        textAnchor="middle"
                        dominantBaseline="middle"
                    >
                        {formatNumber(angle)}
                    </text>
                );
            }
        }
        return markers;
    }, [formatNumber]);

    // Qibla indicator on compass
    const qiblaIndicator = useMemo(() => {
        if (qiblaDirection === null) return null;

        return (
            <g transform={`rotate(${qiblaDirection} 150 150)`}>
                {/* Qibla direction line */}
                <line
                    x1="150"
                    y1="55"
                    x2="150"
                    y2="75"
                    stroke="#f59e0b"
                    strokeWidth="3"
                    strokeLinecap="round"
                    className={`transition-opacity duration-300 ${isAligned ? 'opacity-100' : 'opacity-60'}`}
                />
                
                {/* Kaaba marker background */}
                <circle
                    cx="150"
                    cy="38"
                    r="16"
                    fill={isAligned ? '#fef3c7' : '#f3f4f6'}
                    stroke={isAligned ? '#f59e0b' : '#d1d5db'}
                    strokeWidth="2"
                    className="dark:fill-gray-800 dark:stroke-gray-600 transition-colors duration-300"
                />
                
                {/* Kaaba icon - rotates counter to compass to stay upright */}
                <g transform={`rotate(-${qiblaDirection} 150 38)`}>
                    <g transform="translate(138, 26)">
                        <KaabaIcon size={24} isAligned={isAligned} />
                    </g>
                </g>
            </g>
        );
    }, [qiblaDirection, isAligned]);

    return (
        <div className="flex flex-col items-center justify-center min-h-[80vh] space-y-6 pb-20 px-4">

            {/* Header Info Card */}
            <div className="text-center space-y-3">
                <div className="inline-flex items-center gap-4 px-6 py-4 bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-100 dark:border-gray-700">
                    <div className="text-left">
                        <div className="flex items-center gap-1.5 mb-1">
                            <KaabaIcon size={14} isAligned={isAligned} />
                            <p className="text-[10px] font-semibold uppercase tracking-wider text-gray-400 dark:text-gray-500">
                                {t('qiblaDirection')}
                            </p>
                        </div>
                        <p className={`text-2xl font-bold tabular-nums tracking-tight transition-colors duration-300 ${isAligned ? 'text-green-500' : 'text-primary dark:text-primary-dark'
                            }`}>
                            {qiblaDirection ? `${formatNumber(qiblaDirection.toFixed(0))}` : '--'}
                        </p>
                    </div>
                    <div className="w-px h-14 bg-gray-200 dark:bg-gray-700" />
                    <div className="text-left">
                        <div className="flex items-center gap-1.5 mb-1">
                            <svg className="w-3 h-3 text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                <circle cx="12" cy="12" r="10" />
                                <polygon points="12,2 15,9 12,7 9,9" fill="currentColor" />
                            </svg>
                            <p className="text-[10px] font-semibold uppercase tracking-wider text-gray-400 dark:text-gray-500">
                                {t('heading')}
                            </p>
                        </div>
                        <p className="text-2xl font-bold tabular-nums tracking-tight text-gray-700 dark:text-gray-300">
                            {formatNumber(Math.round(smoothedHeading))}
                        </p>
                    </div>
                </div>
                <p className="text-xs text-gray-400 dark:text-gray-500 flex items-center justify-center gap-1.5">
                    <LocationPinIcon className="w-3 h-3" />
                    {settings.location.address || t('currentLocation')}
                </p>
            </div>

            {/* Compass Container */}
            <div className="relative w-[320px] h-[320px] sm:w-[360px] sm:h-[360px]">

                {/* Outer decorative rings */}
                <div className="absolute -inset-3 rounded-full bg-gradient-to-b from-gray-300 to-gray-400 dark:from-gray-600 dark:to-gray-700 opacity-50" />
                <div className="absolute -inset-2 rounded-full bg-gradient-to-b from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-800 shadow-2xl" />
                <div className="absolute -inset-1 rounded-full bg-gradient-to-b from-white to-gray-50 dark:from-gray-800 dark:to-gray-900" />

                {/* Main Compass Face */}
                <div className={`absolute inset-0 rounded-full shadow-inner overflow-hidden transition-all duration-500 ${isAligned
                        ? 'bg-gradient-to-br from-green-50 via-white to-green-50 dark:from-gray-800 dark:via-gray-850 dark:to-gray-800'
                        : 'bg-gradient-to-br from-gray-50 via-white to-gray-100 dark:from-gray-850 dark:via-gray-900 dark:to-gray-800'
                    }`}>

                    {/* Concentric circle guides */}
                    <svg className="absolute inset-0 w-full h-full" viewBox="0 0 300 300">
                        <circle cx="150" cy="150" r="130" fill="none" stroke="#e5e7eb" strokeWidth="1" className="dark:stroke-gray-700" />
                        <circle cx="150" cy="150" r="100" fill="none" stroke="#e5e7eb" strokeWidth="0.5" className="dark:stroke-gray-700" />
                        <circle cx="150" cy="150" r="70" fill="none" stroke="#e5e7eb" strokeWidth="0.5" className="dark:stroke-gray-700" />
                    </svg>

                    {/* Rotating Compass Dial */}
                    <svg
                        viewBox="0 0 300 300"
                        className="absolute inset-0 w-full h-full"
                        style={{
                            transform: `rotate(${compassRotation}deg)`,
                            transition: 'none',
                        }}
                    >
                        {/* Tick marks */}
                        {ticks}

                        {/* Degree markers */}
                        {degreeMarkers}

                        {/* Cardinal labels */}
                        {cardinalLabels}

                        {/* Qibla Indicator */}
                        {qiblaIndicator}
                    </svg>
                </div>

                {/* Static Top Pointer */}
                <div className="absolute -top-3 left-1/2 -translate-x-1/2 z-20">
                    <div className={`transition-transform duration-300 ${isAligned ? 'scale-110' : 'scale-100'}`}>
                        <CompassNeedleIcon isAligned={isAligned} />
                    </div>
                </div>

                {/* Center Pivot Point */}
                <div className="absolute inset-0 flex items-center justify-center pointer-events-none z-10">
                    <div className="relative">
                        {/* Outer decorative ring */}
                        <div className={`w-24 h-24 sm:w-28 sm:h-28 rounded-full shadow-xl border-4 transition-all duration-300 flex items-center justify-center ${isAligned
                                ? 'bg-gradient-to-br from-green-50 to-green-100 border-green-200 dark:from-green-900/30 dark:to-green-800/30 dark:border-green-700'
                                : 'bg-gradient-to-br from-white to-gray-100 border-gray-200 dark:from-gray-700 dark:to-gray-800 dark:border-gray-600'
                            }`}>
                            {/* Middle ring */}
                            <div className={`w-16 h-16 sm:w-20 sm:h-20 rounded-full shadow-inner flex items-center justify-center transition-all duration-300 ${isAligned
                                    ? 'bg-gradient-to-br from-green-100 to-green-200 dark:from-green-800/50 dark:to-green-900/50'
                                    : 'bg-gradient-to-br from-gray-50 to-gray-200 dark:from-gray-800 dark:to-gray-700'
                                }`}>
                                {/* Inner circle with icon */}
                                <div className={`w-10 h-10 sm:w-12 sm:h-12 rounded-full flex items-center justify-center transition-all duration-300 shadow-lg ${isAligned
                                        ? 'bg-green-500 shadow-green-500/40'
                                        : 'bg-gradient-to-br from-gray-600 to-gray-800 dark:from-gray-500 dark:to-gray-700'
                                    }`}>
                                    {isAligned ? (
                                        <CheckIcon className="w-6 h-6 text-white" />
                                    ) : (
                                        <div className="w-3 h-3 rounded-full bg-white/80" />
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                {/* Alignment glow effect */}
                {isAligned && (
                    <div className="absolute inset-0 rounded-full pointer-events-none">
                        <div className="absolute inset-0 rounded-full bg-green-500/5 animate-pulse" />
                        <div className="absolute inset-2 rounded-full border-2 border-green-400/20 animate-ping" style={{ animationDuration: '2s' }} />
                    </div>
                )}
            </div>

            {/* Status Message */}
            <div className="h-14 flex items-center justify-center">
                {isAligned ? (
                    <div className="inline-flex items-center gap-2.5 px-6 py-3 bg-green-100 dark:bg-green-900/40 text-green-700 dark:text-green-400 text-sm font-semibold rounded-full shadow-lg border border-green-200 dark:border-green-800">
                        <CheckIcon className="w-5 h-5" />
                        {t('facingQibla')}
                    </div>
                ) : (
                    <div className="inline-flex items-center gap-2.5 px-5 py-2.5 bg-gray-100 dark:bg-gray-800 text-gray-500 dark:text-gray-400 text-sm rounded-full border border-gray-200 dark:border-gray-700">
                        <RotateIcon className="w-4 h-4 animate-spin" style={{ animationDuration: '3s' }} />
                        {t('rotateToAlign')}
                    </div>
                )}
            </div>

            {/* Permission Button & Instructions */}
            <div className="text-center px-6 max-w-sm space-y-4">
                {!permissionGranted && isIOS && (
                    <button
                        onClick={startCompass}
                        className="w-full bg-gradient-to-r from-primary to-blue-600 dark:from-primary-dark dark:to-blue-500 text-white px-6 py-4 rounded-2xl font-semibold shadow-xl shadow-primary/25 hover:shadow-2xl hover:shadow-primary/40 active:scale-[0.98] transition-all duration-200 flex items-center justify-center gap-3"
                    >
                        <ShieldCheckIcon className="w-5 h-5" />
                        {t('enableCompass')}
                    </button>
                )}

                {compassError && (
                    <p className="text-sm text-red-500 dark:text-red-400 flex items-center justify-center gap-2">
                        <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                            <circle cx="12" cy="12" r="10" />
                            <line x1="12" y1="8" x2="12" y2="12" />
                            <line x1="12" y1="16" x2="12.01" y2="16" />
                        </svg>
                        {compassError}
                    </p>
                )}

                <div className="bg-amber-50 dark:bg-amber-900/20 rounded-xl p-4 border border-amber-200 dark:border-amber-800/50">
                    <div className="flex items-start gap-3">
                        <InfoIcon className="w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5" />
                        <p className="text-xs text-amber-700 dark:text-amber-400 leading-relaxed text-left">
                            {t('calibrateInstructions')}
                        </p>
                    </div>
                </div>
            </div>
        </div>
    );
};

export default QiblaPage;
